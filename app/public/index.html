<!DOCTYPE html>
<html>

<body>
    <div id="demo">
    </div>
    <div>
        <label for="title">title:</label>
        <input type="text" id="ids" hidden=true>
        <input type="text" id="t1"><br><br>
        <label for="description">description:</label>
        <input type="text" id="d1"><br><br>
        <input type="button" id='addbut' value="ADD" onclick="add()">
        <input type="button" id='editbut' value="UPDATE" onclick="update1()">
        <input type="button" id='cancelbut' value="Cancel" onclick="cancel()">
    </div>

    <script>
        function cancel(){
            document.getElementById('addbut').hidden=false;
            document.getElementById('editbut').hidden=true;
            document.getElementById('cancelbut').hidden=true;
            loadDoc()
        }
        function loadDoc() {
            document.getElementById('editbut').hidden=true;
            document.getElementById('cancelbut').hidden=true;
            document.getElementById('addbut').hidden=false;
            document.getElementById("t1").value = '';
            document.getElementById("d1").value = '';
            document.getElementById("ids").value = '';
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let data = JSON.parse(this.responseText)
                    let tabledata = "";
                    if (Array.isArray(data)) {
                        data.forEach((ele, index) => {
                            if (index == 0) {
                                tabledata = `<tr>`
                                Object.keys(ele).forEach(eles => {
                                    tabledata += `<th>${eles}</th>`
                                })
                                tabledata += `<th>Status</th></tr>`
                            }
                            tabledata += `<tr>`
                            Object.keys(ele).forEach(eles => {
                                tabledata += `<td>${ele[eles]}</td>`
                            })
                            tabledata += `<td><input type='button' onclick="delete1(${ele.id})" value="Del"><input type='button' onclick="edit(${ele.id})" value="Edit"></td></tr>`
                        })
                    } else {

                    }
                    document.getElementById("demo").innerHTML = `<table border=1>${tabledata}</table>`

                }
            };
            xhttp.open("GET", "/api/tutorials", true);
            xhttp.send();
        } 
        loadDoc()
        function edit(id){
            document.getElementById('addbut').hidden=true;
            document.getElementById('editbut').hidden=false;
            document.getElementById('cancelbut').hidden=false;
            let xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener("readystatechange", function () {
                    if (this.readyState === 4 && this.status == 200) {
                        let data = JSON.parse(this.responseText)
                        console.log(this.responseText);
                        document.getElementById("ids").value = data.id;
                        document.getElementById("t1").value = data.title;
                        document.getElementById("d1").value = data.description;
                    }
                });

                xhr.open("GET", `/api/tutorials/${id}`);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.send();
        }
        function add() {
            var t1 = document.getElementById("t1").value;
            var d1 = document.getElementById("d1").value;
            if (t1.length > 0 && d1.length > 0) {
                console.log(t1 + " " + d1);
                var data = JSON.stringify({
                    "title": t1,
                    "description": d1
                });

                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener("readystatechange", function () {
                    if (this.readyState === 4 && this.status == 200) {
                        console.log(this.responseText);
                        loadDoc();
                    };
                });
                xhr.open("POST", "/api/tutorials");
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send(data);
            }
        }

        function delete1(id) {
            

                let xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener("readystatechange", function () {
                    if (this.readyState === 4 && this.status == 200) {
                        console.log(this.responseText);
                        loadDoc();
                    }
                });

                xhr.open("DELETE", `/api/tutorials/${id}`);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.send();

            } 

        function update1() {
            var id = document.getElementById("ids").value;
            var t1 = document.getElementById("t1").value;
            var d1 = document.getElementById("d1").value;
            if (t1.length > 0 && d1.length > 0) {
                console.log(t1 + " " + d1);
                var data = JSON.stringify({
                    "title": t1,
                    "description": d1
                });

                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener("readystatechange", function () {
                    if (this.readyState === 4 && this.status == 200) {
                        console.log(this.responseText);
                        loadDoc();
                    }
                });

                xhr.open("PUT", `/api/tutorials/${id}`);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.send(data);
            }
        }
    </script>


</body>

</html>